---
import { getTasks } from '../tasks.js';

// Se obtiene la URL de la solicitud actual
const url = new URL(Astro.request.url);
const statusFilter = url.searchParams.get('status') || 'all';

// Se obtienen las tareas segÃºn el filtro de estado
const tasks = getTasks(statusFilter);
---

<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Gestor de Tareas</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <header>
      <h1>
        <span class="highlight">TO</span>DO
      </h1>
      <nav>
        <a href="#"class="tab">Personal</a>
        <a href="#"class="tab">Professional</a>
        <a href="#" class="add-task">+</a>
      </nav>
    </header>

    <main>
      <!-- Formulario para agregar tareas -->
      <form action="/api/add-task" method="post" id="formulario-tarea">
        <input 
          type="text" 
          name="description" 
          placeholder="What do you need to do?" 
          required 
          id="entrada-tarea" 
        />
        <button type="submit">ADD</button>
      </form>

      <!-- Botones de filtrado por estado -->
      <div class="filters">
        <a href="/?status=all&filter={categoryFilter}" class={`filter ${statusFilter === 'all' ? 'active' : ''}`}>All</a>
        <a href="/?status=incomplete&filter={categoryFilter}" class={`filter ${statusFilter === 'incomplete' ? 'active' : ''}`}>Incomplete</a>
        <a href="/?status=complete&filter={categoryFilter}" class={`filter ${statusFilter === 'complete' ? 'active' : ''}`}>Complete</a>
      </div>

      <!-- Lista de Tareas -->
      <ul id="lista-tareas">
        {tasks.map((task) => (
          <li class="tarea" data-status={task.status}>
            {task.status === 'complete' ? (
              <form action="/api/update-task" method="post" style="display:inline;">
                <input type="hidden" name="id" value={task.id} />
                <input type="hidden" name="status" value="incomplete" />
                <input type="checkbox" checked onchange="this.form.submit()" />
              </form>
            ) : (
              <form action="/api/update-task" method="post" style="display:inline;">
                <input type="hidden" name="id" value={task.id} />
                <input type="hidden" name="status" value="complete" />
                <input type="checkbox" onchange="this.form.submit()" />
              </form>
            )}
            <label class={task.status === 'complete' ? 'done' : ''}>
              {task.description}
            </label>
            <form action="/api/delete-task" method="post" style="display:inline;">
              <input type="hidden" name="id" value={task.id} />
              <button type="submit" class="delete-task">ðŸ—‘</button>
            </form>
          </li>
        ))}
      </ul>

      <!-- BotÃ³n para eliminar tareas completadas -->
      <form action="/api/clear-completed" method="post" class="clear-form">
        <button type="submit" class="clear-completed">Clear Completed</button>
      </form>
    </main>
  </body>
</html>
